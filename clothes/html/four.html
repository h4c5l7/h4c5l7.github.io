<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>四区</title>
		<script type="text/javascript" src="../js/jquery-1.11.2.js" ></script>
		<script type="text/javascript" src="js/jquery.form.js" ></script>
		<link rel="stylesheet" href="css/oper.css" />
		<style>
			*{
				padding: 0;
				margin: 0;
				border: 0;
				font-family: "microsoft yahei";
			}
			html,body{
				width: 100%;
				height: 100%;
				overflow: hidden;
			}
			#four_table{
				width: 65%;
				height: 100%;
				padding: 20px;
				box-sizing: border-box;
				float: left;
			}
			#four_table thead{
				background: #ccc;
			}
			#four_table tbody{
				background: #B3EE3A;
			}
			#four_table thead tr td{
				text-align: center;
				height: 70px;
				line-height: 70px;
				font-size: 2em;
				font-weight: bolder;
			}
			#four_table tr td{
				text-align: center;
				vertical-align: top;
				border: 1px solid #000;
			}
		</style>
	</head>
	<body>
		<table id="four_table">
			<thead><tr><td colspan="4">四区</td></tr></thead>
			<tbody>
				<tr></tr>
				<tr></tr>
				<tr></tr>
				<tr></tr>
			</tbody>
		</table>
		<form id="fourForm" method="post" action="pullIn_post">
			<ul>
				<li class="search_li">
					<h3>查询</h3>
					<p>
						<label>订单编号</label>
						<input type="text" id="search_orderNum" name="search_orderNum"/>
						<input id="searchBtn" type="button" value="查询订单">
					</p>
				</li>
				<li class="into_li">
					<h3>入库</h3>
					<ul>
						<li>
							<label>订单编号</label>
							<input type="text" id="orderNum" name="orderNum"/>
							<input type="submit" id="pullInStorageBtn" value="入库"/>
						</li>
						<li>
							<label>存放位置</label>
							<select id="store_id" name="store_id"></select>
						</li>
						<li>
							<label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;价格</label>
							<input type="text" id="price" name="price"/>
						</li>
						<li>
							<label>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;备注</label>
							<textarea id="remark" name="remark"></textarea>
						</li>
					</ul>
				</li>
			</ul>
		</form>
	</body>
	<script>
		$(document).ready(function() {
			var fourPage = {
			initPage:function(){
				var array0=[1];
				var array1=[2,3,4,5];
				var array2=[6,7,8,9];
				var array3=[10,11,12,13];
				var $tbody = $("#four_table tbody");
				for(let i=1;i<=13;i++){
					$("#store_id").append("<option value='four_"+i+"'>"+i+"</option");
				}
				for(let i=0;i<array0.length;i++){
					$tbody.find("tr").eq(0).append("<td colspan='4'>"+array0[i]+"</td>");
				}
				for(let i=0;i<array1.length;i++){
					$tbody.find("tr").eq(1).append("<td>"+array1[i]+"</td>");
				}
				for(let i=0;i<array2.length;i++){
					$tbody.find("tr").eq(2).append("<td>"+array2[i]+"</td>");
				}
				for(let i=0;i<array3.length;i++){
					$tbody.find("tr").eq(3).append("<td>"+array3[i]+"</td>");
				}
			},
			//校验
			verifyFun:function(){
				var orderNum = $("#orderNum").val();
				if(orderNum == false){
					alert("请输入订单编号！");
					return false;
				}
				var re2 =  /^[0-9a-zA-Z]*$/g;
				if(!re2.test(orderNum)){
					alert("订单编号只能输入数字和字母");
					return false;
				}
				var re = /^\d+(?=\.{0,1}\d+$|$)/;
				var price =  $("#price").val();
				if(!re.test(price)){
					alert("价格请输入正确的数字");
					return false;
				}
				return true;
			},
			//初始化事件
			initEvent:function(){
				_this = this;
				//查询订单
				$("#searchBtn").on('click',function(){
					var search_orderNum = $("#search_orderNum").val();
					if(search_orderNum == ""){
						alert("请输入订单编号查询！");
						return false;
					}
					$.ajax({
						url:"/search_post",
						type:"POST",
						data:"search_orderNum="+search_orderNum,
						success:function(result){
							if(result === false){
								alert("在仓库内没有查询到该订单！");
							}else{
								//出库
								if(confirm(result)){
									//确认出库
									//让 status变为2，
									$.ajax({
										url:"/pullOut_post",
										type:"POST",
										data:"_id="+search_orderNum,
										success:function(result1){
											alert(result1);
										}
									})
								}
							}
						}
					})
				})
			}
			
		}
		fourPage.initPage();
		fourPage.initEvent();
	    var options = {
			success:function(data,statusText){
				alert(data);
			},
			error:function(data){
				alert(data.message);
			},
			beforeSubmit:function(arr,$form,options){
				return fourPage.verifyFun();
			}
		};
	    // bind form using 'ajaxForm' 
	    $('#fourForm').ajaxForm(options).submit(function(){return false;}); 
	 });	
	</script>
</html>
